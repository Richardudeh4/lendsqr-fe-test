import { useState, useEffect, useRef, useMemo } from 'react'
import { useNavigate } from 'react-router-dom'
import './Users.scss'
import { fetchUsers } from '../services/api'
import type { User } from '../services/api'
import { useSearch } from '../contexts/SearchContext'

function Users() {
  const navigate = useNavigate()
  const { searchQuery } = useSearch()
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const [currentPage, setCurrentPage] = useState(1)
  const [itemsPerPage, setItemsPerPage] = useState(100)
  const [totalUsers, setTotalUsers] = useState(0)
  const [totalPages, setTotalPages] = useState(0)
  const [activeUsers, setActiveUsers] = useState(0)
  const [usersWithLoans, setUsersWithLoans] = useState(0)
  const [usersWithSavings, setUsersWithSavings] = useState(0)
  const [showFilterForm, setShowFilterForm] = useState(false)
  const [filterFormPosition, setFilterFormPosition] = useState({ top: 0, left: 0 })
  const [openDropdownId, setOpenDropdownId] = useState<string | null>(null)
  const filterFormRef = useRef<HTMLDivElement | null>(null)
  const [allUsers, setAllUsers] = useState<User[]>([])

  // Fetch all users once to calculate statistics and for search
  useEffect(() => {
    const loadUsers = async () => {
      try {
        setLoading(true)
        setError(null)
        // Fetch all users (using a large limit to get all users)
        const response = await fetchUsers(1, 1000)
        setAllUsers(response.users)

        // Calculate statistics
        const activeCount = response.users.filter(user => user.status === 'Active').length
        setActiveUsers(activeCount)
        setUsersWithLoans(0)
        setUsersWithSavings(0)
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Failed to load users')
        console.error('Error loading users:', err)
      } finally {
        setLoading(false)
      }
    }

    loadUsers()
  }, [])


  // Filter users based on search query (case-insensitive search)
  const filteredUsers = useMemo(() => {
    if (!searchQuery.trim()) {
      return allUsers
    }

    // Convert search query to lowercase for case-insensitive matching
    const query = searchQuery.toLowerCase().trim()
    return allUsers.filter((user) => {
      // Compare lowercase versions of all fields with lowercase query
      return (
        user.organization?.toLowerCase().includes(query) ||
        user.username?.toLowerCase().includes(query) ||
        user.email?.toLowerCase().includes(query) ||
        user.phone?.toLowerCase().includes(query) ||
        user.status?.toLowerCase().includes(query)
      )
    })
  }, [allUsers, searchQuery])

  // Apply pagination to filtered users
  const paginatedFilteredUsers = useMemo(() => {
    const startIndex = (currentPage - 1) * itemsPerPage
    const endIndex = startIndex + itemsPerPage
    return filteredUsers.slice(startIndex, endIndex)
  }, [filteredUsers, currentPage, itemsPerPage])

  // Update totals when filtered users change
  useEffect(() => {
    setTotalUsers(filteredUsers.length)
    setTotalPages(Math.ceil(filteredUsers.length / itemsPerPage))
  }, [filteredUsers.length, itemsPerPage])

  // Reset to page 1 when search query changes
  useEffect(() => {
    if (searchQuery.trim() && currentPage > 1) {
      setCurrentPage(1)
    }
  }, [searchQuery])

  const getStatusClass = (status: string) => {
    switch (status) {
      case 'Active':
        return 'status-active'
      case 'Inactive':
        return 'status-inactive'
      case 'Pending':
        return 'status-pending'
      case 'Blacklisted':
        return 'status-blacklisted'
      default:
        return ''
    }
  }

  const handleMoreOptionsClick = (e: React.MouseEvent, userId: string) => {
    e.stopPropagation()
    setOpenDropdownId(openDropdownId === userId ? null : userId)
  }

  const handleMenuAction = (action: string, user: User) => {
    setOpenDropdownId(null)
    if (action === 'view') {
      navigate(`/dashboard/users/${user._id}`, { state: { user } })
    } else if (action === 'blacklist') {
      // Handle blacklist action
      console.log('Blacklist user:', user._id)
    } else if (action === 'activate') {
      // Handle activate action
      console.log('Activate user:', user._id)
    }
  }

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = () => {
      setOpenDropdownId(null)
    }
    if (openDropdownId) {
      document.addEventListener('click', handleClickOutside)
      return () => document.removeEventListener('click', handleClickOutside)
    }
  }, [openDropdownId])

  // Close filter modal when clicking anywhere outside it
  useEffect(() => {
    if (!showFilterForm) return

    const handleClickOutside = (event: MouseEvent) => {
      if (filterFormRef.current && !filterFormRef.current.contains(event.target as Node)) {
        setShowFilterForm(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [showFilterForm])

  return (
    <div className="users-container">
      <h1 className="users-title">Users</h1>
      {/* Overview Cards */}
      <div className="overview-cards">
        <div className="overview-card">
          <div className="card-icon users-icon">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_5530_2782)">
                <path d="M13.9977 9.68179C13.9977 9.81686 14.0328 10.0913 14.1178 10.382C14.2032 10.6741 14.3346 10.9667 14.5182 11.1505L14.6578 11.2902V11.4787C14.6578 12.3877 14.324 12.9833 13.8395 13.4054C13.3612 13.822 12.7391 14.0664 12.1735 14.2853C11.8334 14.4364 11.52 14.5391 11.1959 14.7189L11.109 14.7677L10.694 14.0207L10.6432 13.9289L10.736 13.882C11.1072 13.6959 11.4771 13.5482 11.8434 13.4015C12.4329 13.1618 12.8843 12.9657 13.1998 12.6984C13.5009 12.4433 13.68 12.1207 13.7203 11.6154C13.4856 11.3131 13.3318 10.94 13.233 10.6076C13.1352 10.2781 13.0886 9.98305 13.068 9.82632C12.6737 9.21067 12.4774 8.57634 12.5846 8.10269C12.4941 7.74721 12.4406 7.27889 12.5006 6.82144C12.561 6.36152 12.7373 5.902 13.1158 5.58707C13.3499 4.91212 13.8423 4.42475 14.4772 4.12613L14.4811 4.12515L14.6696 4.05289C15.5699 3.74249 16.7245 3.81043 17.7838 4.24722L18.0094 4.34683L18.0153 4.34879V4.34976L18.3453 4.5314L18.4205 4.57339L18.3903 4.65445L18.2809 4.94742L18.2799 4.94644C18.1112 5.42114 18.244 5.79222 18.4264 6.23062H18.4254C18.6452 6.74408 18.8763 7.39118 18.5455 8.18863C18.6116 8.62062 18.4547 9.24589 18.0621 9.8605C18.0416 10.0173 17.996 10.3129 17.8981 10.6427C17.7991 10.9758 17.6444 11.3499 17.4088 11.6525C17.4323 12.1563 17.6113 12.4784 17.9166 12.7336C18.2366 13.0008 18.6966 13.1971 19.2858 13.4367C19.8884 13.6742 20.595 13.9555 21.1471 14.465C21.7045 14.9795 22.1002 15.7217 22.1002 16.8664V17.3332H14.567V16.3996H21.151C21.0642 15.7553 20.8034 15.3419 20.4371 15.0373C20.044 14.7104 19.5282 14.5045 18.9567 14.2834C18.3911 14.0645 17.7689 13.8201 17.2906 13.4035C16.8063 12.9814 16.4733 12.3855 16.4733 11.4767V11.2882L16.6119 11.1496C16.7947 10.9668 16.9174 10.6754 16.9987 10.382C17.0791 10.0915 17.115 9.81316 17.1334 9.66714V9.53922L17.15 9.51382L17.2213 9.40933C17.418 9.08728 17.5244 8.81234 17.5768 8.61148C17.603 8.51108 17.6157 8.43024 17.6198 8.37222C17.6218 8.3431 17.621 8.3208 17.6198 8.30582C17.6183 8.28776 17.6163 8.28833 17.6207 8.29703V8.29605L17.5475 8.14957L17.528 8.10953L17.5446 8.06754L17.6168 7.88492L17.6217 7.87418L17.6676 7.7814C17.8711 7.32427 17.7172 6.97776 17.5426 6.48843V6.48746C17.3664 6.06557 17.1854 5.59068 17.2711 4.97964C16.4298 4.64816 15.5397 4.62589 14.8932 4.93179L14.8893 4.93375C14.4065 5.14084 14.1322 5.48232 13.9928 5.9689L13.9567 6.11343L13.9479 6.15054L13.9156 6.17203L13.8063 6.24332C13.6046 6.38325 13.4913 6.66772 13.4557 7.00601C13.4205 7.34026 13.4645 7.70187 13.5514 7.96304L13.5543 7.96988V7.97086L13.5905 8.11734L13.6002 8.15347L13.5836 8.18668L13.5143 8.32339C13.5113 8.33533 13.508 8.36767 13.5123 8.42398C13.5169 8.48306 13.5301 8.56198 13.5582 8.65933C13.6005 8.80571 13.6757 8.99198 13.8014 9.21207L13.944 9.44351L13.9508 9.45328H13.9498L13.9869 9.52652L13.9977 9.548V9.68179Z" fill="#DF18FF" stroke="#DF18FF" stroke-width="0.2" />
                <path d="M7.22363 4.52124C7.87989 4.52124 8.40008 4.66179 8.81445 4.90601C9.22883 5.1503 9.53199 5.49446 9.75879 5.89136C10.0967 6.48278 10.2696 7.19861 10.3965 7.88843L10.5127 8.56421V8.56519C10.6045 9.15342 10.6949 9.71383 10.8477 10.1814C11.0002 10.648 11.2096 11.0058 11.5273 11.2078L11.8555 11.3894L11.9502 11.4421L11.8906 11.532L11.6699 11.8621C11.153 12.6366 10.0063 13.3593 8.81836 13.7058C9.2264 14.8936 10.2109 15.2405 11.2891 15.6355H11.29C11.9098 15.8543 12.5973 16.0983 13.127 16.5476C13.6634 17.0027 14.0332 17.6634 14.0332 18.7V19.1667H-0.0996094V18.7C-0.0996044 17.6633 0.26994 17.0027 0.811523 16.5476C1.34566 16.0988 2.04121 15.8549 2.67969 15.6365L3.08887 15.4841C4.00038 15.1322 4.79456 14.7126 5.15039 13.7058C3.96318 13.3591 2.81656 12.6371 2.30078 11.863L2.08105 11.533L2.02051 11.4431L2.11523 11.3904L2.43945 11.2107L2.55957 11.1228C2.82242 10.9064 2.97265 10.6081 3.06152 10.2488C3.16393 9.83454 3.1826 9.34991 3.20117 8.83374C3.21952 8.17824 3.23734 7.42617 3.49707 6.77905C3.75845 6.12813 4.26233 5.58715 5.22949 5.33765C5.5379 5.032 6.14614 4.52133 7.22363 4.52124ZM7.22168 5.4519C6.41962 5.4519 6.04074 5.83108 5.78906 6.08276L5.69922 6.17261L5.67676 6.18042L5.56738 6.21655L5.55664 6.22046V6.21948C5.22817 6.29046 4.98107 6.40063 4.79395 6.5437C4.60762 6.68622 4.47571 6.86593 4.38086 7.08374C4.18848 7.52573 4.1504 8.11968 4.13184 8.87476V8.87573C4.11387 9.36866 4.09576 9.9007 3.9834 10.3972C3.87777 10.8638 3.68514 11.3036 3.3291 11.6589C3.88016 12.2061 4.87865 12.7454 5.81055 12.9177H5.81152L6.17871 12.991L6.27637 13.0105L6.25684 13.1082L6.18457 13.4753L6.18359 13.4773C5.95833 14.491 5.47697 15.1354 4.88574 15.5847C4.44573 15.919 3.9458 16.1438 3.4541 16.3357L2.96777 16.5203C2.41229 16.7242 1.92397 16.8937 1.55273 17.1589C1.21374 17.4011 0.975082 17.7232 0.887695 18.2332H13.0781C12.9907 17.7403 12.7532 17.418 12.4141 17.1716C12.1355 16.9693 11.7902 16.8182 11.4014 16.6697L10.999 16.5203C10.3608 16.283 9.65777 16.0305 9.06641 15.5847C8.4704 15.1353 7.98884 14.491 7.78223 13.4763V13.4753L7.70898 13.1082L7.68945 13.0105L7.78809 12.991L8.15527 12.9177H8.15625L8.33887 12.8796C9.21746 12.6745 10.1239 12.1682 10.6387 11.656C10.3147 11.3019 10.1061 10.8555 9.95801 10.3679C9.79984 9.84704 9.70652 9.27183 9.61523 8.70483V8.70386C9.4316 7.65571 9.25967 6.84207 8.91895 6.28882C8.75053 6.01551 8.54204 5.80856 8.27148 5.6687C7.99999 5.52837 7.65935 5.45195 7.22168 5.4519Z" fill="#DF18FF" stroke="#DF18FF" stroke-width="0.2" />
              </g>
              <defs>
                <clipPath id="clip0_5530_2782">
                  <rect width="22" height="22" fill="white" />
                </clipPath>
              </defs>
            </svg>

          </div>
          <p className="card-label">USERS</p>
          <p className="card-value">{totalUsers.toLocaleString()}</p>
        </div>

        <div className="overview-card">
          <div className="card-icon active-users-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.9304 19.6199C17.5104 14.5852 11.3814 12.2253 7.77222 15.8728C6.80705 16.8488 6.17083 18.1941 6.04956 19.6199H17.9304ZM16.3523 11.4207C15.8819 12.2386 15.1922 12.9136 14.3601 13.3611C15.5211 13.7743 16.5451 14.487 17.3435 15.4041H20.9548C20.6883 13.0931 18.7194 11.3423 16.3523 11.4207ZM7.64917 11.4207C5.2826 11.3429 3.31414 13.0944 3.04761 15.4041H6.6355C7.4366 14.4818 8.4657 13.7708 9.63159 13.3562C8.80269 12.9107 8.11741 12.2355 7.64917 11.4207ZM11.988 4.98904C9.2419 4.99014 7.2784 7.87742 8.50073 10.5398C9.88154 13.5437 14.118 13.541 15.4988 10.5398C16.6823 7.96699 14.9018 5.02485 11.988 4.98904ZM18.5291 5.22049C17.5822 4.26328 16.1117 4.11123 14.9949 4.82889C16.6081 6.03682 17.3696 8.11262 16.8757 10.115C19.1941 9.82808 20.211 6.91941 18.5291 5.22049ZM9.00757 4.82791C7.14963 3.62727 4.64057 4.96059 4.64038 7.26053C4.64038 8.71797 5.71215 9.93256 7.12378 10.1131C6.63107 8.1109 7.39435 6.03518 9.00757 4.82791ZM22.1433 15.9812C22.1433 16.3006 21.8847 16.5602 21.5642 16.5603H18.1638C18.7587 17.6096 19.1335 18.9317 19.1335 20.199C19.1335 20.5185 18.8751 20.7781 18.5544 20.7781L5.41577 20.7752H5.40894C5.24286 20.7636 5.10539 20.6931 5.0105 20.5769C4.93584 20.4855 4.89265 20.3705 4.87769 20.243H4.86792V20.1433C4.86792 18.8383 5.2144 17.6162 5.81421 16.5613H2.4353C2.26469 16.5613 2.11878 16.4982 2.01538 16.3836C1.91329 16.2704 1.85954 16.1151 1.8562 15.9402V15.7215C1.89699 13.5383 3.34591 11.5119 5.35718 10.6795C1.99561 8.57299 3.4527 3.22244 7.48218 3.22244C8.45433 3.22251 9.37691 3.57803 10.0955 4.20682C11.3072 3.70739 12.6923 3.70739 13.9041 4.20682C16.4677 1.96185 20.518 3.79553 20.5183 7.25858C20.5183 8.6745 19.7842 9.95037 18.6394 10.6775C20.76 11.5462 22.1127 13.5777 22.1433 15.9803V15.9812Z" fill="#5718FF" stroke="#5718FF" stroke-width="0.2" />
              <path d="M13.6077 9.50116C13.7498 9.46596 13.899 9.49074 14.0237 9.55487C14.1484 9.61907 14.2552 9.72639 14.3088 9.86249C14.3632 10.001 14.3592 10.1626 14.2747 10.3264C13.3196 12.1789 10.6818 12.1788 9.72583 10.3264C9.64155 10.1625 9.63817 10.0009 9.69263 9.86249C9.74626 9.72641 9.85323 9.61901 9.97778 9.55487C10.1022 9.49094 10.2512 9.46685 10.3928 9.50214C10.537 9.5382 10.6669 9.63444 10.7512 9.79803C11.2786 10.8154 12.7213 10.8176 13.2473 9.79803C13.3324 9.63413 13.4629 9.53712 13.6077 9.50116Z" fill="#5718FF" stroke="#5718FF" stroke-width="0.2" />
            </svg>

          </div>
          <p className="card-label">ACTIVE USERS</p>
          <p className="card-value">{activeUsers.toLocaleString()}</p>
        </div>

        <div className="overview-card">
          <div className="card-icon loans-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.96167 0.400011V16.4118H8.31567V15.2118H3.16167V1.60001H9.19987V5.95781H13.3155V9.65381H14.5155V4.92561L10.0881 0.399811L1.96167 0.400011ZM10.3999 2.43601L12.6741 4.75781H10.3999V2.43601Z" fill="#F55F44" />
              <path d="M4.3938 8.35242H11.604V9.55242H4.3938V8.35242Z" fill="#F55F44" />
              <path d="M4.3938 10.9524H8.004V12.1524H4.3938V10.9524Z" fill="#F55F44" />
              <path d="M18.0381 17.9422V12.4C18.0381 10.7719 14.1921 10.7258 13.7537 10.7258C13.3154 10.7258 9.47168 10.7758 9.47168 12.4V17.9796C9.47246 18.0406 9.48262 18.1007 9.50215 18.1577C9.84355 19.5601 13.3381 19.5999 13.7561 19.5999C14.1741 19.5999 17.9561 19.5523 18.0357 17.9741C18.0357 17.9656 18.0381 17.9562 18.0381 17.9421L18.0381 17.9422ZM16.8381 14.1422C16.5998 14.3618 15.4998 14.7203 13.7561 14.7203C12.0115 14.7203 10.9201 14.3617 10.6717 14.15V13.6344C11.8396 14.0602 13.4717 14.0782 13.7561 14.0782C14.0405 14.0782 15.6717 14.0578 16.8405 13.6344L16.8381 14.1422ZM10.6717 15.4758C11.8396 15.9016 13.4717 15.9196 13.7561 15.9196C14.0405 15.9196 15.6717 15.8993 16.8405 15.4758L16.8397 16C16.592 16.2118 15.4999 16.5704 13.7553 16.5704C12.0115 16.5704 10.9201 16.2 10.6717 16L10.6717 15.4758ZM13.7561 11.9298C15.2561 11.9298 16.2741 12.1954 16.6881 12.404C16.274 12.604 15.256 12.8783 13.7561 12.8783C12.2561 12.8783 11.2357 12.6142 10.8241 12.4001C11.2358 12.2001 12.2538 11.9298 13.7561 11.9298ZM10.6717 17.8344V17.318C11.8396 17.7438 13.4717 17.7618 13.7561 17.7618C14.0405 17.7618 15.6717 17.7415 16.8405 17.318V17.8336C16.5897 18.0461 15.4999 18.4 13.7561 18.4C12.0115 18.4 10.9201 18.0461 10.6717 17.8344Z" fill="#F55F44" />
            </svg>

          </div>
          <p className="card-label">USERS WITH LOANS</p>
          <p className="card-value">{usersWithLoans.toLocaleString()}</p>
        </div>

        <div className="overview-card">
          <div className="card-icon savings-icon">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_5530_2742)">
                <path d="M11.625 -0.0996094C12.9713 -0.099582 14.2046 0.131079 15.1055 0.53418C15.9998 0.934439 16.6006 1.52193 16.6006 2.25C16.6006 2.97807 15.9998 3.56556 15.1055 3.96582C14.2046 4.36892 12.9713 4.59958 11.625 4.59961C10.2789 4.59961 9.04534 4.36898 8.14453 3.96582C7.25029 3.56556 6.65039 2.97807 6.65039 2.25C6.65039 1.52193 7.25029 0.934439 8.14453 0.53418C9.04534 0.131021 10.2789 -0.0996094 11.625 -0.0996094ZM11.625 0.850586C10.486 0.850586 9.467 1.03887 8.73633 1.31641C8.37056 1.45534 8.08125 1.61488 7.88574 1.78027C7.68851 1.9472 7.60059 2.10808 7.60059 2.25C7.60059 2.39192 7.68851 2.5528 7.88574 2.71973C8.08125 2.88512 8.37056 3.04466 8.73633 3.18359C9.467 3.46113 10.486 3.64941 11.625 3.64941C12.7639 3.64939 13.7829 3.46113 14.5137 3.18359C14.8795 3.04466 15.1687 2.88512 15.3643 2.71973C15.5616 2.55277 15.6504 2.39193 15.6504 2.25C15.6504 2.10807 15.5616 1.94723 15.3643 1.78027C15.1687 1.61488 14.8795 1.45534 14.5137 1.31641C13.7829 1.03887 12.7639 0.850612 11.625 0.850586Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M7.60059 2.15039V4.5C7.60059 4.64192 7.68851 4.8028 7.88574 4.96973C8.08125 5.13512 8.37056 5.29466 8.73633 5.43359C9.467 5.71113 10.486 5.89941 11.625 5.89941C12.7639 5.89939 13.7829 5.71112 14.5137 5.43359C14.8795 5.29466 15.1687 5.13512 15.3643 4.96973C15.5616 4.80277 15.6504 4.64193 15.6504 4.5V2.15039H16.6006V4.5C16.6006 5.22807 15.9998 5.81556 15.1055 6.21582C14.2046 6.61892 12.9713 6.84958 11.625 6.84961C10.2789 6.84961 9.04534 6.61898 8.14453 6.21582C7.25029 5.81556 6.65039 5.22807 6.65039 4.5V2.15039H7.60059Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M16.6006 4.40033V6.74994C16.6006 7.47801 15.9998 8.0655 15.1055 8.46576C14.2046 8.86886 12.9713 9.09952 11.625 9.09955C11.2407 9.09955 10.8653 9.08103 10.5049 9.04486L10.501 8.94525L10.415 8.9472C10.4059 8.56978 10.3994 8.31446 10.3994 8.24994C10.3994 8.23408 10.3987 8.21696 10.3965 8.20013L10.3799 8.07318L10.5068 8.08783C10.8616 8.12817 11.2363 8.14935 11.625 8.14935C12.7639 8.14933 13.7829 7.96106 14.5137 7.68353C14.8795 7.5446 15.1687 7.38506 15.3643 7.21967C15.5616 7.05271 15.6504 6.89187 15.6504 6.74994V4.40033H16.6006ZM7.60059 4.40033V6.74994C7.60059 6.76643 7.60126 6.78284 7.60352 6.79974L7.62012 6.9267L7.49316 6.91205C7.25315 6.88492 7.00295 6.86641 6.74609 6.85736L6.73828 6.85638L6.72949 6.85443L6.65039 6.83881V4.40033H7.60059Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M16.6006 6.65045V9.00006C16.6006 9.72813 15.9998 10.3156 15.1055 10.7159C14.2046 11.119 12.9713 11.3496 11.625 11.3497C11.2612 11.3497 10.9053 11.3335 10.5625 11.3008L10.3096 11.2764L10.4707 11.1514C10.4642 10.9101 10.458 10.6738 10.4521 10.4464L10.4492 10.3321L10.5635 10.3438C10.9008 10.38 11.2574 10.3995 11.625 10.3995C12.7639 10.3994 13.7829 10.2112 14.5137 9.93365C14.8795 9.79473 15.1687 9.63517 15.3643 9.46979C15.5616 9.30285 15.6504 9.14198 15.6504 9.00006V6.65045H16.6006ZM7.60059 6.65045V6.92389L7.48926 6.91119C7.24972 6.88473 7.00153 6.86653 6.74609 6.85748L6.65039 6.85358V6.65045H7.60059Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M6.37476 6.65039C7.72076 6.65039 8.95444 6.88108 9.85522 7.28418C10.7495 7.68444 11.3503 8.27193 11.3503 9C11.3503 9.72807 10.7495 10.3156 9.85522 10.7158C8.95444 11.1189 7.72076 11.3496 6.37476 11.3496C5.02844 11.3496 3.79508 11.119 2.89429 10.7158C1.99996 10.3156 1.40015 9.72807 1.40015 9C1.40015 8.27193 1.99996 7.68444 2.89429 7.28418C3.79508 6.88105 5.02844 6.65045 6.37476 6.65039ZM6.37476 7.60059C5.23596 7.60064 4.21684 7.7889 3.48608 8.06641C3.12051 8.20526 2.832 8.365 2.63647 8.53027C2.439 8.69728 2.35034 8.85803 2.35034 9C2.35034 9.14196 2.439 9.30272 2.63647 9.46973C2.832 9.635 3.12052 9.79474 3.48608 9.93359C4.21684 10.2111 5.23596 10.3994 6.37476 10.3994C7.51361 10.3994 8.53277 10.2111 9.26343 9.93359C9.6292 9.79466 9.9185 9.63512 10.114 9.46973C10.3113 9.30276 10.4001 9.14195 10.4001 9C10.4001 8.85805 10.3113 8.69724 10.114 8.53027C9.9185 8.36488 9.6292 8.20534 9.26343 8.06641C8.53277 7.78891 7.51361 7.60059 6.37476 7.60059Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M2.35034 8.90039V11.25C2.35034 11.392 2.439 11.5527 2.63647 11.7197C2.832 11.885 3.12052 12.0447 3.48608 12.1836C4.21684 12.4611 5.23596 12.6494 6.37476 12.6494C7.51361 12.6494 8.53277 12.4611 9.26343 12.1836C9.6292 12.0447 9.9185 11.8851 10.114 11.7197C10.3113 11.5528 10.4001 11.392 10.4001 11.25V8.90039H11.3503V11.25C11.3503 11.9781 10.7495 12.5656 9.85522 12.9658C8.95444 13.3689 7.72076 13.5996 6.37476 13.5996C5.02844 13.5996 3.79508 13.369 2.89429 12.9658C1.99996 12.5656 1.40015 11.9781 1.40015 11.25V8.90039H2.35034Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M2.35034 11.1504V13.5C2.35034 13.642 2.439 13.8027 2.63647 13.9697C2.832 14.135 3.12052 14.2947 3.48608 14.4336C4.21684 14.7111 5.23596 14.8994 6.37476 14.8994C7.51361 14.8994 8.53277 14.7111 9.26343 14.4336C9.6292 14.2947 9.9185 14.1351 10.114 13.9697C10.3113 13.8028 10.4001 13.642 10.4001 13.5V11.1504H11.3503V13.5C11.3503 14.2281 10.7495 14.8156 9.85522 15.2158C8.95444 15.6189 7.72076 15.8496 6.37476 15.8496C5.02844 15.8496 3.79508 15.619 2.89429 15.2158C1.99996 14.8156 1.40015 14.2281 1.40015 13.5V11.1504H2.35034Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M2.35034 13.4004V15.75C2.35034 15.892 2.439 16.0527 2.63647 16.2197C2.832 16.385 3.12052 16.5447 3.48608 16.6836C4.21684 16.9611 5.23596 17.1494 6.37476 17.1494C7.51361 17.1494 8.53277 16.9611 9.26343 16.6836C9.6292 16.5447 9.9185 16.3851 10.114 16.2197C10.3113 16.0528 10.4001 15.892 10.4001 15.75V13.4004H11.3503V15.75C11.3503 16.4781 10.7495 17.0656 9.85522 17.4658C8.95444 17.8689 7.72076 18.0996 6.37476 18.0996C5.02844 18.0996 3.79508 17.869 2.89429 17.4658C1.99996 17.0656 1.40015 16.4781 1.40015 15.75V13.4004H2.35034Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M16.6006 8.90042V11.25C16.6006 11.9781 15.9998 12.5656 15.1055 12.9659C14.2046 13.3689 12.9713 13.5996 11.625 13.5996C11.2825 13.5996 10.9474 13.5848 10.623 13.5557L10.5625 13.5508L10.5391 13.4942L10.5322 13.4776V13.459C10.5259 13.2153 10.519 12.961 10.5127 12.7022L10.5098 12.5889L10.6221 12.6006C10.9422 12.6326 11.2782 12.6494 11.625 12.6494C12.7639 12.6494 13.7828 12.4612 14.5137 12.1836C14.8795 12.0447 15.1687 11.8852 15.3643 11.7198C15.5616 11.5528 15.6504 11.392 15.6504 11.25V8.90042H16.6006Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
                <path d="M16.6003 11.1504V13.5C16.6003 14.228 16.0003 14.8156 15.1062 15.2158C14.2053 15.619 12.9713 15.8496 11.6248 15.8496C11.3043 15.8496 10.9895 15.8363 10.6853 15.8115L10.6208 15.8066L10.5994 15.7461L10.5935 15.7305V15.7148C10.5907 15.6183 10.5835 15.345 10.573 14.958L10.5691 14.8457L10.6824 14.8555C10.9843 14.884 11.2996 14.8994 11.6248 14.8994C12.7637 14.8994 13.7826 14.7111 14.5134 14.4336C14.8793 14.2947 15.1684 14.1351 15.364 13.9697C15.5614 13.8027 15.6501 13.6419 15.6501 13.5V11.1504H16.6003Z" fill="#FF3366" stroke="#FF3366" stroke-width="0.2" />
              </g>
              <defs>
                <clipPath id="clip0_5530_2742">
                  <rect width="18" height="18" fill="white" />
                </clipPath>
              </defs>
            </svg>

          </div>
          <p className="card-label">USERS WITH SAVINGS</p>
          <p className="card-value">{usersWithSavings.toLocaleString()}</p>
        </div>
      </div>

      {/* Filter Form */}
      {showFilterForm && (
        <div 
          className="filter-form-overlay"
          onClick={() => setShowFilterForm(false)}
        >
          <div 
            className="filter-form"
            ref={filterFormRef}
            onClick={(e) => e.stopPropagation()}
            style={{
              position: 'fixed',
              top: `${filterFormPosition.top}px`,
              left: `${filterFormPosition.left}px`,
            }}
          >
            <div className="filter-field">
              <label>Organization</label>
              <div className="filter-input-wrapper">
                <input type="text" placeholder="Select" />
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg" className="dropdown-icon">
                  <path d="M1 1L6 6L11 1" stroke="#545F7D" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              </div>
            </div>

            <div className="filter-field">
              <label>Username</label>
              <input type="text" placeholder="User" />
            </div>

            <div className="filter-field">
              <label>Email</label>
              <input type="email" placeholder="Email" />
            </div>

            <div className="filter-field">
              <label>Date</label>
              <div className="filter-input-wrapper">
                <input type="text" placeholder="Date" />
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" className="calendar-icon">
<g clip-path="url(#clip0_5530_2554)">
<path d="M14.9919 2.16002H12.7037V0.768152C12.7037 0.560024 12.5437 0.400024 12.3356 0.400024H10.6562C10.4481 0.400024 10.2881 0.560024 10.2881 0.768152V2.16002H5.7118V0.768152C5.7118 0.560024 5.5518 0.400024 5.34367 0.400024H3.66367C3.45554 0.400024 3.29554 0.560024 3.29554 0.768152V2.16002H1.00802C0.816149 2.16002 0.639893 2.32002 0.639893 2.52815V15.2482C0.639893 15.4563 0.799893 15.6163 1.00802 15.6163H14.9917C15.1836 15.6163 15.3598 15.4563 15.3598 15.2482V2.52815C15.3598 2.32002 15.1836 2.16002 14.9917 2.16002H14.9919ZM11.0082 1.13628H11.9682V3.24812H11.0082V1.13628ZM4.01637 1.13628H4.97637V3.24812H4.01637V1.13628ZM14.6239 14.8638H1.37637V5.5038H14.6245L14.6239 14.8638Z" fill="#545F7D"/>
<path d="M3.19994 13.2164H4.91178C5.00803 13.2164 5.08803 13.1364 5.08803 13.0401V11.3119C5.08803 11.2157 5.00803 11.1357 4.91178 11.1357L3.19994 11.1363C3.10369 11.1363 3.02368 11.2163 3.02368 11.3126V13.0244C3.02368 13.1363 3.10368 13.2163 3.19994 13.2163V13.2164Z" fill="#545F7D"/>
<path d="M7.13635 13.2164H8.84819C8.94444 13.2164 9.02444 13.1364 9.02444 13.0401L9.02382 11.3119C9.02382 11.2157 8.94382 11.1357 8.84756 11.1357L7.13636 11.1363C7.04011 11.1363 6.96011 11.2163 6.96011 11.3126V13.0244C6.94386 13.1363 7.02386 13.2163 7.13636 13.2163L7.13635 13.2164Z" fill="#545F7D"/>
<path d="M11.0565 13.2164H12.7684C12.8646 13.2164 12.9446 13.1364 12.9446 13.0401L12.944 11.3119C12.944 11.2157 12.864 11.1357 12.7677 11.1357L11.0565 11.1363C10.9603 11.1363 10.8803 11.2163 10.8803 11.3126V13.0244C10.864 13.1363 10.944 13.2163 11.0565 13.2163L11.0565 13.2164Z" fill="#545F7D"/>
<path d="M3.19994 9.26372H4.91178C5.00803 9.26372 5.08803 9.18372 5.08803 9.08746V7.37627C5.08803 7.28002 5.00803 7.20001 4.91178 7.20001H3.19994C3.10369 7.20001 3.02368 7.28001 3.02368 7.37627V9.0881C3.02368 9.18373 3.10368 9.26374 3.19994 9.26374V9.26372Z" fill="#545F7D"/>
<path d="M7.13635 9.26372H8.84819C8.94444 9.26372 9.02444 9.18372 9.02444 9.08746L9.02382 7.37627C9.02382 7.28002 8.94382 7.20001 8.84756 7.20001H7.13636C7.04011 7.20001 6.96011 7.28001 6.96011 7.37627V9.0881C6.94386 9.18373 7.02386 9.26374 7.13636 9.26374L7.13635 9.26372Z" fill="#545F7D"/>
<path d="M11.0565 9.26372H12.7684C12.8646 9.26372 12.9446 9.18372 12.9446 9.08746L12.944 7.37627C12.944 7.28002 12.864 7.20001 12.7677 7.20001H11.0565C10.9603 7.20001 10.8803 7.28001 10.8803 7.37627V9.0881C10.864 9.18373 10.944 9.26374 11.0565 9.26374L11.0565 9.26372Z" fill="#545F7D"/>
</g>
<defs>
<clipPath id="clip0_5530_2554">
<rect width="16" height="16" fill="white"/>
</clipPath>
</defs>
</svg>
</div>
            </div>

            <div className="filter-field">
              <label>Phone Number</label>
              <input type="tel" placeholder="Phone Number" />
            </div>

            <div className="filter-field">
              <label>Status</label>
              <div className="filter-input-wrapper">
                <input type="text" placeholder="Select" />
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg" className="dropdown-icon">
                  <path d="M1 1L6 6L11 1" stroke="#545F7D" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              </div>
            </div>

            <div className="filter-actions">
              <button className="filter-reset-btn" onClick={() => setShowFilterForm(false)}>Reset</button>
              <button className="filter-submit-btn" onClick={() => setShowFilterForm(false)}>Filter</button>
            </div>
          </div>
        </div>
      )}

      {/* Users Table */}
      <div className="users-table-container">
        <table className="users-table">
          <thead>
            <tr>
              <th 
                onClick={(e) => {
                  const rect = e.currentTarget.getBoundingClientRect()
                  setFilterFormPosition({ top: rect.bottom + 30, left: rect.left })
                  setShowFilterForm(!showFilterForm)
                }}
                style={{ cursor: 'pointer', position: 'relative' }}
              >
                ORGANIZATION
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>
              </th>
              <th>
                USERNAME
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>

              </th>
              <th>
                EMAIL
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>

              </th>
              <th>
                PHONE NUMBER
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>

              </th>
              <th>
                DATE JOINED
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>

              </th>
              <th>
                STATUS
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.22222 13.3333H9.77778V11.5555H6.22222V13.3333ZM0 2.66666V4.44443H16V2.66666H0ZM2.66667 8.88888H13.3333V7.1111H2.66667V8.88888Z" fill="#545F7D" />
                </svg>

              </th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {loading ? (
              <>
                {[...Array(10)].map((_, index) => (
                  <tr key={index} className="skeleton-row">
                    <td><div className="skeleton skeleton-text"></div></td>
                    <td><div className="skeleton skeleton-text"></div></td>
                    <td><div className="skeleton skeleton-text"></div></td>
                    <td><div className="skeleton skeleton-text"></div></td>
                    <td><div className="skeleton skeleton-text"></div></td>
                    <td><div className="skeleton skeleton-badge"></div></td>
                    <td><div className="skeleton skeleton-icon"></div></td>
                  </tr>
                ))}
              </>
            ) : error ? (
              <tr>
                <td colSpan={7} style={{ textAlign: 'center', padding: '2rem', color: '#E4033B' }}>
                  Error: {error}
                </td>
              </tr>
            ) : paginatedFilteredUsers.length === 0 ? (
              <tr>
                <td colSpan={7} style={{ textAlign: 'center', padding: '2rem' }}>
                  {searchQuery.trim() ? `No users found matching "${searchQuery}"` : 'No users found'}
                </td>
              </tr>
            ) : (
              paginatedFilteredUsers.map((user) => (
                <tr
                  key={user._id}
                  onClick={() => navigate(`/dashboard/users/${user._id}`, { state: { user } })}
                  style={{ cursor: 'pointer' }}
                >
                  <td>{user.organization}</td>
                  <td>{user.username}</td>
                  <td>{user.email}</td>
                  <td>{user.phone}</td>
                  <td>{user.dateJoined}</td>
                  <td>
                    <span className={`status-badge ${getStatusClass(user.status)}`}>
                      {user.status}
                    </span>
                  </td>
                  <td onClick={(e) => e.stopPropagation()}>
                    <div className="more-options-container">
                      <div
                        className="more-options-btn"
                        onClick={(e) => handleMoreOptionsClick(e, user._id)}
                      >
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M10 10.8333C10.4603 10.8333 10.8334 10.4602 10.8334 9.99999C10.8334 9.53975 10.4603 9.16666 10 9.16666C9.53978 9.16666 9.16669 9.53975 9.16669 9.99999C9.16669 10.4602 9.53978 10.8333 10 10.8333Z" fill="#545F7D" />
                          <path d="M10 5.00001C10.4603 5.00001 10.8334 4.62692 10.8334 4.16667C10.8334 3.70643 10.4603 3.33334 10 3.33334C9.53978 3.33334 9.16669 3.70643 9.16669 4.16667C9.16669 4.62692 9.53978 5.00001 10 5.00001Z" fill="#545F7D" />
                          <path d="M10 16.6667C10.4603 16.6667 10.8334 16.2936 10.8334 15.8333C10.8334 15.3731 10.4603 15 10 15C9.53978 15 9.16669 15.3731 9.16669 15.8333C9.16669 16.2936 9.53978 16.6667 10 16.6667Z" fill="#545F7D" />
                        </svg>
                      </div>
                      {openDropdownId === user._id && (
                        <div className="more-options-dropdown" onClick={(e) => e.stopPropagation()}>
                          <div 
                            className="dropdown-item"
                            onClick={() => handleMenuAction('view', user)}
                          >
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 3.0365C9.83851 3.0366 11.4995 3.88567 12.7979 4.85583C13.9379 5.70768 14.8031 6.66047 15.2764 7.22888V7.224L15.4531 7.43982C15.7068 7.74878 15.7063 8.24809 15.4531 8.55701L15.4541 8.55798C15.043 9.07387 14.0971 10.173 12.7979 11.1439C11.4995 12.1142 9.83851 12.9632 8 12.9633C6.1615 12.9633 4.50051 12.114 3.20215 11.1459C1.90278 10.1769 0.956583 9.0818 0.545898 8.57458L0.544922 8.57361C0.277669 8.23466 0.27494 7.76787 0.544922 7.44177L0.951172 6.95642C1.45155 6.38435 2.22763 5.584 3.20215 4.85583C4.50055 3.88572 6.1615 3.0365 8 3.0365ZM8 4.24353C6.48689 4.24353 5.06331 4.96939 3.92285 5.8158C2.83646 6.6221 2.01764 7.53103 1.63477 7.99841C2.02655 8.45429 2.84591 9.36271 3.92969 10.1722C5.06829 11.0227 6.48736 11.7562 8 11.7562C9.51294 11.7561 10.932 11.0303 12.0703 10.184C13.1553 9.37728 13.974 8.46733 14.3643 7.99939C13.9738 7.5313 13.1549 6.62217 12.0703 5.8158C10.932 4.96946 9.51294 4.24363 8 4.24353Z" fill="#545F7D" stroke="#545F7D" stroke-width="0.2"/>
<path d="M8.00049 4.90857C9.70365 4.90876 11.0923 6.29716 11.0923 8.00037C11.0921 9.70342 9.70354 11.092 8.00049 11.0922C6.29728 11.0922 4.90888 9.70353 4.90869 8.00037C4.90869 6.29704 6.2971 4.90857 8.00049 4.90857ZM8.00049 6.11658C6.96767 6.11658 6.1167 6.96747 6.1167 8.00037C6.1168 9.0325 6.96767 9.88416 8.00049 9.88416C9.03309 9.88396 9.88417 9.03298 9.88428 8.00037C9.88428 6.96766 9.03315 6.11677 8.00049 6.11658Z" fill="#545F7D" stroke="#545F7D" stroke-width="0.2"/>
</svg>

                            <span>View Details</span>
                          </div>
                          <div 
                            className="dropdown-item"
                            onClick={() => handleMenuAction('blacklist', user)}
                          >
                          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.36816 6.46869C7.58194 6.53028 8.73405 7.0392 9.59766 7.90228C10.5181 8.8233 11.0354 10.0726 11.0371 11.3749V13.1249C11.0371 13.2672 10.9808 13.4039 10.8799 13.5048C10.779 13.6057 10.6423 13.662 10.5 13.662H1.75C1.60769 13.662 1.47101 13.6057 1.37012 13.5048C1.26924 13.4039 1.21289 13.2672 1.21289 13.1249V11.3749L1.21875 11.1318C1.28035 9.91801 1.78927 8.76588 2.65234 7.90228C3.51591 7.03922 4.66801 6.53024 5.88184 6.46869L6.125 6.46283L6.36816 6.46869ZM8.04395 8.0517C6.85648 7.36575 5.39354 7.36575 4.20605 8.0517C3.01866 8.73704 2.28713 10.0041 2.28711 11.3749V12.5878H9.96289L9.96191 11.3749C9.96189 10.0043 9.23135 8.73711 8.04395 8.0517ZM11.4863 4.37885C11.6974 4.17449 12.0328 4.17794 12.2402 4.3847L12.3086 4.46771C12.4451 4.67374 12.425 4.95385 12.2461 5.13861L11.6973 5.68744L12.2441 6.23431L12.3135 6.31537C12.3742 6.40316 12.4072 6.50789 12.4082 6.61615C12.4092 6.72409 12.3774 6.82922 12.3184 6.91791L12.251 7.00092C12.1494 7.10303 12.0101 7.15949 11.8662 7.15814C11.7225 7.15679 11.5854 7.09845 11.4854 6.99506L10.9375 6.4472L10.3887 6.99603C10.2039 7.17489 9.9238 7.19505 9.71777 7.05853L9.63477 6.99017C9.42801 6.78275 9.42454 6.44736 9.62891 6.23627L10.1777 5.68744L9.62891 5.13861C9.42455 4.92753 9.428 4.59213 9.63477 4.3847L9.71777 4.31635C9.89425 4.19945 10.1251 4.19733 10.3037 4.31146L10.3887 4.37885L10.9375 4.92767L11.4863 4.37885ZM6.125 0.33783C6.84772 0.33783 7.54083 0.62476 8.05176 1.13568C8.56268 1.64663 8.8496 2.33972 8.84961 3.06244C8.84961 3.78516 8.56268 4.47827 8.05176 4.9892C7.5408 5.50012 6.84771 5.78705 6.125 5.78705H6.08398L6.08105 5.78412C5.37443 5.77218 4.69969 5.48888 4.19922 4.9892L4.19824 4.98822C3.68823 4.47739 3.40096 3.78495 3.40039 3.06244C3.4004 2.33972 3.68732 1.6466 4.19824 1.13568C4.7092 0.624761 5.40228 0.33783 6.125 0.33783ZM6.125 1.41205C5.21393 1.41318 4.47572 2.15137 4.47461 3.06244C4.47461 3.72962 4.87707 4.3316 5.49316 4.58685C6.10984 4.8426 6.82021 4.70122 7.29199 4.22943C7.76376 3.75768 7.90516 3.04728 7.64941 2.4306C7.39414 1.81453 6.79216 1.41205 6.125 1.41205Z" fill="#545F7D" stroke="#545F7D" stroke-width="0.2"/>
</svg>

                            <span>Blacklist User</span>
                          </div>
                          <div 
                            className="dropdown-item"
                            onClick={() => handleMenuAction('activate', user)}
                          >
                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_5530_2525)">
<path d="M10.6968 12.9022L10.6997 12.8993L10.8208 12.9882L10.8228 12.9862L10.8247 12.9833L13.3589 9.44421C13.4719 9.28662 13.4539 9.08197 13.3286 8.94714L13.2681 8.89343C13.203 8.84631 13.1298 8.8238 13.0581 8.82019L13.0493 8.8114L12.9731 8.8241C12.8717 8.84041 12.7806 8.89614 12.7173 8.98425L10.1821 12.5194C10.0896 12.6233 9.97165 12.6517 9.90576 12.6561H9.90479C9.83681 12.6609 9.7084 12.6479 9.60107 12.5487L9.59814 12.5458L7.96631 10.954C7.80801 10.7992 7.56278 10.8033 7.40869 10.9608C7.25444 11.1186 7.25757 11.3629 7.41455 11.5175H7.41553L9.05029 13.1132L9.05225 13.1151C9.27506 13.3271 9.57346 13.4452 9.87939 13.4452C9.89983 13.4452 9.9239 13.4436 9.94678 13.4423V13.4432H9.9585C10.2887 13.4215 10.5983 13.2598 10.8071 13.0028L10.8101 13.0009L10.8149 12.995C10.8159 12.9938 10.8161 12.992 10.8169 12.9911H10.8179L10.8169 12.9921L10.7114 12.913L10.6968 12.9022ZM10.6968 12.9022L10.8013 13.0057C10.7999 13.0069 10.7991 13.0092 10.7974 13.0106C10.7943 13.013 10.7854 13.0198 10.7729 13.0262C10.7663 13.0295 10.7492 13.0361 10.7388 13.0389C10.7223 13.0418 10.681 13.041 10.6567 13.035C10.642 13.0283 10.6229 13.0144 10.606 12.9989C10.6111 12.9939 10.6175 12.9903 10.6226 12.9852L10.6948 12.9042L10.6968 12.9022ZM6.99951 0.554565C8.85581 0.554565 10.3606 2.06074 10.3608 3.91687C10.3608 4.94967 9.89438 5.87309 9.16162 6.49011L9.01123 6.60925L8.83057 6.74402L9.04443 6.81433C9.86902 7.08529 10.6375 7.52163 11.3013 8.10144C11.4679 8.24718 11.4846 8.49077 11.3394 8.6571C11.1931 8.82347 10.9485 8.83907 10.7827 8.69421C9.83329 7.8647 8.64048 7.37289 7.38818 7.28796L7.13721 7.27625H7.13037L6.99854 7.27917L6.86768 7.27625H6.86084L6.61279 7.28796C4.06534 7.46035 1.8932 9.32364 1.36768 11.8466V11.8475C1.32747 12.0396 1.37677 12.2408 1.50049 12.3934L1.50439 12.3983C1.57947 12.4893 1.749 12.6327 2.00146 12.6327H6.51318C6.73387 12.6329 6.90674 12.8064 6.90674 13.0272C6.90664 13.2492 6.73315 13.4206 6.51318 13.4208H2.00146C1.56696 13.4208 1.16315 13.2292 0.88916 12.8925C0.613426 12.5533 0.507675 12.1163 0.597168 11.6874C0.898856 10.2391 1.6976 8.91981 2.84717 7.97449C3.47422 7.45886 4.19129 7.06755 4.95459 6.81628L5.16846 6.745L4.98877 6.61023C4.16967 5.99654 3.63723 5.02001 3.63721 3.91785C3.63721 2.10422 5.07414 0.62645 6.87061 0.558472L6.87158 0.554565H6.99951ZM6.73584 1.35632C5.44143 1.48867 4.42354 2.58894 4.42334 3.91687V4.03503H4.4624L4.47607 4.1698C4.60501 5.42429 5.60271 6.42518 6.86865 6.48816L6.87842 6.48914H6.87939C6.91718 6.48863 6.96076 6.48718 6.99951 6.48718C7.03836 6.48718 7.07875 6.48705 7.12061 6.48816H7.12939L7.38037 6.46375C8.61869 6.27902 9.57373 5.20456 9.57373 3.91687C9.57351 2.49988 8.41516 1.34363 6.99854 1.34363L6.73584 1.35632Z" fill="#545F7D" stroke="#545F7D" stroke-width="0.3"/>
</g>
<defs>
<clipPath id="clip0_5530_2525">
<rect width="14" height="14" fill="white"/>
</clipPath>
</defs>
</svg>

                            <span>Activate User</span>
                          </div>
                        </div>
                      )}
                    </div>
                  </td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>
      {/* Pagination */}
      <div className="pagination-container">
        <div className="pagination-left">
          <span>Showing</span>
          <select
            className="items-per-page"
            value={itemsPerPage}
            onChange={(e) => {
              setItemsPerPage(Number(e.target.value))
              setCurrentPage(1)
            }}
          >
            <option value={100}>100</option>
            <option value={50}>50</option>
            <option value={25}>25</option>
          </select>
          <span>out of {totalUsers}</span>
        </div>
        <div className="pagination-right">
          <button
            className="pagination-btn"
            onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
            disabled={currentPage === 1}
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="#213F7D" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
            </svg>
          </button>
          <div className="page-numbers">
            {totalPages > 0 ? (
              <>
                {currentPage > 1 && (
                  <span
                    className="page-number"
                    onClick={() => setCurrentPage(1)}
                  >
                    1
                  </span>
                )}
                {currentPage > 3 && <span className="page-dots">...</span>}
                {currentPage > 2 && (
                  <span
                    className="page-number"
                    onClick={() => setCurrentPage(currentPage - 1)}
                  >
                    {currentPage - 1}
                  </span>
                )}
                <span className="page-number active">{currentPage}</span>
                {currentPage < totalPages - 1 && (
                  <span
                    className="page-number"
                    onClick={() => setCurrentPage(currentPage + 1)}
                  >
                    {currentPage + 1}
                  </span>
                )}
                {currentPage < totalPages - 2 && <span className="page-dots">...</span>}
                {currentPage < totalPages && (
                  <span
                    className="page-number"
                    onClick={() => setCurrentPage(totalPages)}
                  >
                    {totalPages}
                  </span>
                )}
              </>
            ) : (
              <span className="page-number active">1</span>
            )}
          </div>
          <button
            className="pagination-btn"
            onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
            disabled={currentPage === totalPages}
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="#213F7D" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  )
}

export default Users
